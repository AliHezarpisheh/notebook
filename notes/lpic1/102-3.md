# Manage Shared Libraries

## Linking

Programs usually use libraries. In Linux, a program should link a library to use the
features of it. Linking has two forms:

- Static linking: In this way of linking, the executable program is added to the
  program. The program siz gets big but the advantage of it is that no dependencies are
  needed in runtime.

- Dynamic: The program will use the loaded dependency of it in the memory. This way,
  updating is easier and the program is smaller.

Linux dynamic libraries have name like `libLIBNAME.so.VERSION` and are located at:
`/lib*/` and `/usr/lib*/`. On Windows they are called Dynamic Linked Libraries(DLLs).

> Libraries related to system utils are at `/lib*/` and libraries installed by other
> softwares will be located at `/usr/lib/`(Aren't these symlinked to each other?).

**Commands**:

- ldd /lib/libudev.so.1 -> What libraries are programmed linked to. Is the program even
  dynamically linked?
- ldconfig -> Process all the files to make the loading of libraries faster. This
  command creates `ld.so.cache` to locate files that are to be dynamically loaded or to
  be linked.

> ðŸ’¡ Libraries are mostly symlinked to the exact version of them. You can think of
> symlink as pointers in the programming languages. e.g. libudev.so.1 -> libudev.so.17.2

Dynamic linking is configured in files at `/etc/ld.so.conf.d/`.

```bash
cat /etc/ld.so.conf
include /etc/ld.so.conf.d/*.conf

ls /etc/ld.so.conf.d/
fakeroot-x86_64-linux-gnu.conf  libc.conf  x86_64-linux-gnu.conf
```

**OS order to find dynamic libraries:**

1. `LD_LIBRARY_PATH` environment variable.
2. Program PATH.
3. `/etc/ld.so.conf`
4. \`\*\*/lib\*/

## Linux Dynamic Loader

You can use linux dynamic loader to run programs. You can also use it to run the
programs that are not executable!

```bash
/usr/lib64/ld-linux-x86-64.so.2 /usr/bin/ls
bin ...

readelf -Wl /usr/bin/ls

Elf file type is DYN (Position-Independent Executable file)
Entry point 0x6aa0
There are 13 program headers, starting at offset 64

Program Headers:
  Type           Offset   VirtAddr           PhysAddr           FileSiz  MemSiz   Flg
  PHDR           0x000040 0x0000000000000040 0x0000000000000040 0x0002d8 0x0002d8 R
  INTERP         0x000318 0x0000000000000318 0x0000000000000318 0x00001c 0x00001c R
      [Requesting program interpreter: /lib64/ld-linux-x86-64.so.2]
```

*See! the interpreter of /usr/lib/ls is `/lib64/ld-linux-x86-64.so.2`.*
