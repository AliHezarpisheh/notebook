# Perform Basic File Management

## Wildcards and File Globbing

File globbing also known as wildcard matching, is a mechanism used in command-line
shells and programming languages to match file patterns or other string based patterns
based on patterns containing special characters called wildcards.

- `*`: Means any string.
- `?`: Means exactly one character.
- `[ABC]`: Matches A, B, or C.
- `[a-k]`: Matches a, b, c, ..., k(just lower-case).
- `[0-9a-z]`: Matches all numbers and lower-case letters.
- `[!x]`: Matches everything except x.

```bash
rm *  # Remove everything in the current directory.
ls A*B  # Show everything which starts with A and ends with B.
cp ???.* /tmp/  # Copy every file with 3 characters before a dot, and then any string
# to the /tmp dir.
```

## ls

List directory contents. I found out that you can use the `-R` switch to show the files
inside the directories recursively.

## cp, mv, and rm

### cp

Copy files from one place to another place. If the target is a directory, all files will
be copied there.

For copying a directory you would favor using the `-r` switch to recursively copy the
files inside the dir.

### mv

Will move or rename files. Work like cp. If you are moving a file on the same file
system, the inode won't change.

It has some formulas but they are common sense I don't need to cover them. But I draw
your attention to this fun behavior:

```bash

cat /tmp/A
cat A
echo "Hi" > A
cp A /tmp/A
cat /tmp/A
Hi
```

### rm

Remove files. You can use `-r` switch to recursively remove files in a directory, and
remove th directory itself too. You can use `-f` to force delete. Yeah now u see where
the `rm -rf` command is coming from. Use `-i` to do everything interactively.

## mkdir and rmdir

Use `mkdir` to make a directory:) I mean literally. Use `-p` switch to create the
parents.

You can remove a directory using `rmdir`. Use `-p` switch to remove the parents. The
directory must be empty.

## Some Useful and Nice Commands:)

### touch

It will create an empty file or modify the file timestamp. The default timestamp is now.

```bash
ls
-rw-rw-r-- 1 ali ali 0 Dec  2 19:32 a

touch a
ls -lrth
total 0
-rw-rw-r-- 1 ali ali 0 Dec  2 19:42 a

touch -t 201001010000.00 a
touch -d 11am a
touch -d "1 hour ago" a
touch -r /etc/debian_version a
```

### file

Determine file type. Use `-i` switch to prints the mime format.

### dd

Convert and copy a file. It copies from input to its output(say file or device).
Commonly people use it to read/write from block devices.

```bash
dd if=note_to_self of=new_file

dd if=/dev/sda of=backup.dd bs=4096

dd if=/dev/sda2 | gzip > backup.dd.gzip
```

### find

Search for files in a directory hierarchy. The syntax looks like: *find where-to-look
criteria -what-to-do*

**New switches I already don't know about**:

- `-iname`: Case insensitive name.
- `-size`: Specify the size of the file.
  - `-size 100c`: Exactly 100 character/bytes.
  - `-size +10k`: More than 100 kilobytes.
  - `-size -1G`: Less than a gigabyte.
- `-empty`: Find empty files. Like the `-size 0b`.

Another useful search criterion in `find` is time:

| switch | meaning              | samples                                                                                                                                                                                         |
| ------ | -------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| -amin  | Access Minute        | `-amin 40` search for files that are accessed exactly 40 minutes ago. `-amin -40` would search for files that are accessed less than 40 minutes ago. Can you guess what `-amin +40` would do:)? |
| -cmin  | Status Change Minute | `-cmin +60` means files that their inode metadata has been modified before the last hour                                                                                                        |
| -mmin  | Modified Minute      | `-mmin -20` means files that their actual content has been modified in the last 20 minutes.                                                                                                     |

There are `-atime`, `-ctime`, and `-mtime` switches that are kinda weird. They find
files that are modified(based on the first char) in days. For example, `-atime +1` means
files that access more than 1 day ago(which means 2 days and more).

> Btw, there is a `-newer file1` switch which will find you the files that are newer
> than the file1 that has been referenced.

There are `-print` and `-ls` switches too. `-print` will print the file full names and
`-ls` will run `ls -dils` on the founded files.

**Super important note about -print. It will separate the file names using \\n but some
tools like xargs will separate files using spaces. In such cases you would favor using
`-print0` that will separate file names using a NULL character.**

> You can use `-delete` command to delete the founded files.

The most interesting switch for the find command is: `-exec`. You have already worked
with it. Lets break down the syntax of it:

- `{}` expands to the pathname of the founded file or directory.
- `;` specify the ending of the exec command. It should be escaped using `\` character.
- `+` collects founded pathnames into groups and execute the command on each group.

```bash
# Below commands are all the same
find
find -print
find . -print
find . -iname * -print
```

### EXTRA: What is inode?

An inode(index node) is a data structure on a unix-like filesystem that stores metadata
about a file except its name. Think of it as the file identity. It stores metadata such
as:

- File type(regular, symlink, directory, etc).
- Permissions(rwx), owner UID, GID.
- Timestamps(mtime, ctime, atime).
- File size.
- Links count.
- Pointers to disk block that points to the file actual data.

```bash
ls -i Anemone.2025.1080p.10bit.WEB-DL.6CH.x265.SoftSub.DigiMoviez.mkv
20354365 Anemone.2025.1080p.10bit.WEB-DL.6CH.x265.SoftSub.DigiMoviez.mkv
```

When you are moving(mv) a file in the same filesystem, kernel won't make the inode
change. It just do a operation called `rename` in the kernel level. The inode number
stays the same and the file's data will remain the same.

```bash
mv /home/ali/mio /tmp/mio  # Node inode number is changed.
```

On the other hand, when you move a file to a different filesystem(like a flash usb), the
mv command should copy and remove the inode from the current file system and paste it in
the new inode space/table. Also it would copy the file to the new filesystem.

## Compression

Compression exploits redundancies and patterns in data to represent the same information
in fewer bits.

There are two general compression categories:

<!-- markdownlint-disable MD029 -->

1. Lossless Compression (what linux uses for files):

- Original data perfectly reconstructible.
- Use algorithm patterns (repeated sequences, statistical frequency, etc).
- Like: gzp, bzip2, xz. We are going to learn their tools.

2. Lossy Compression (media files):

- Discard unnecessary information.
- Smaller size, can't fully recover original.
- JPEG, MP3.

<!-- markdownlint-enable MD029 -->

| Tool      | Algorithm       | Speed    | Ratio  | Extension | Common Use                        |
| --------- | --------------- | -------- | ------ | --------- | --------------------------------- |
| **gzip**  | DEFLATE         | Fast     | Good   | `.gz`     | General purpose, default choice   |
| **bzip2** | Burrows-Wheeler | Moderate | Better | `.bz2`    | When size matters more than speed |
| **xz**    | LZMA2           | Slow     | Best   | `.xz`     | Maximum compression               |

### gzip and gunzip

```bash
ls -sh 1g.bin
1.1G 1g.bin

gzip -k 1g.bin  # -k keeps the file.
ls -lrth
total 1.1G
-rw-rw-r-- 1 ali ali 1018K Dec  3 02:18 1g.bin.gz
-rw-rw-r-- 1 ali ali  1.0G Dec  3 02:18 1g.bin

rm 1g.bin
gunzip 1g.bin.gz
ls -lrth
total 1.0G
-rw-rw-r-- 1 ali ali 1.0G Dec  3 02:18 1g.bin
```

`gzip` preserves time.

### bzip2 and bunzip2

```bash
bzip2 1g.bin
ls -lrth
total 8.0K
-rw-rw-r-- 1 ali ali  785 Dec  3 02:18 1g.bin.bz2

bunzip2 1g.bin.bz2
ls -lrth
total 1.1G
-rw-rw-r-- 1 ali ali 1.0G Dec  3 02:18 1g.bin
```

### xz and unxz

```bash
xz 1g.bin
ls -lrth
total 160K
-rw-rw-r-- 1 ali ali 153K Dec  3 02:18 1g.bin.xz

unxz 1g.bin.xz
ls -lrth
total 8.0K
-rw-rw-r-- 1 ali ali 1.0G Dec  3 02:18 1g.bi
```

## Archiving

Archiving means bundling files. No compression is done. Compressing is done on the
single files. Most of the time we archive and compress files and directories, then move
it somewhere else.

### tar

TapeARchive or tar is the most used archiving tool.

| Switch          | Description                                           |
| --------------- | ----------------------------------------------------- |
| -cf archive.tar | Create a file named archive.tar.                      |
| -xf archive.tar | Extract an archived file named archive.tar.           |
| -z              | Compress the archive file using gzip after archiving. |
| -j              | Compress using bzip2.                                 |
| -r              | Append new files to the currently available archive.  |

```bash
tar -cvf archive.tar idk/
idk/
idk/hi
idk/hello

ls
1g.bin  archive.tar  idk

tar -xvf archive.tar

tar -czvf archive.tar.gz ./  # Archive and compress current directory in archive.tar.gz.
```

### cpio

Get a list of files and creates an archive. This tool is not usually used.

```bash
ls | cpio -o > archive.cpio
3090354 blocks

find . -name "*" | cpio -o > archive.cpio

mkdir extract
mv archive.cpio extract
cd extract
cpio -id < archive.cpio
```

## EXTRA: How to read man pages?

You have already now how to read them except the SYNOPSIS section. Lets observe the
SYNOPSIS syntax:

*command [OPTIONS] required_arg [optional_arg]*

**Notation rules:**

- `[brackets]` = optional
- `<angle brackets>` or plain text = required
- `...` = can be repeated
- `|` = choose one option (OR)
- `-a | --all` = short form OR long form (same option)
