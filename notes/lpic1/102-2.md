# Install a Boot Manager

We have three famous boot loaders. Lilo, grub1(0.9 technically), and the most used and
recent one, grub2.

As I said and wrote +100000 times till now, we have two type of firmware. BIOS and UEFI.
On BIOS, system will do a POST(PowerOnSelfTest) to. Then it will handle the process to
the bootloader and the bootloader will read the first sector of Master Boot Record(MBR)
which is track(Cylinder) 0, side(Head) 0, and sector 1 of the first disk.

MBR is only 512MB which is not sufficient for new boot loaders. Some versions of Lilo
could fit in that place. That sector would then load a smarter bootloader(e.g. grub2) to
load the kernel and initramfs.

On UEFI, the hardware will follow UEFI stages. They start with a security phase and will
continue till the end phase where the UEFI looks for an EFI system partition, which is
just a FAT32 partition, with PE executables and runs them.

> ðŸ’¡ Chain loading is when a bootloader loads another bootloader. This is done when a
> Linux bootloader needs to load a Windows bootloader.

## Grub

Started to replace Lilo. Grub1(0.9) is Grub Legacy and started in 1999. The second
version started in 2005 for complete rewrite of version 1.

It's a menu-based system where you can choose the kernel or chainloader to boot.

### Grub Legacy

It is installed under `/boot/grub`. Its main configuration is at `/boot/grub/menu.lst`.
Nowadays some distributions link the menu.lst to `/boot/grub/grub.cfg`. The config
consists of 2 main sections. The first section is global config and the second one
defines different kernel/initramfs or chainloader options.

I can not understand the benefit of listing the config options so I am not doing it.

These are some related commands:

```bash
grub-install /dev/sda1  # After changing the config
```

You can install the bootloader on a CD, floppy, MBR, or a partition but if you want to
install a place other than MBR, use a chainloader to point your boot sequence towards
it.

### Grub2

Most common bootloader these days. On BIOS systems it is installed in the `/boot/grub/`
or `/boot/grub2`. In UEFI systems, it is installed under `/boot/efi/EFI/<DISTRO>/`. The
grub2 configuration is the `grub.cfg` file. It has more programming interface than the
grub1 configuration. We don't change this file for configuring the grub2. Instead, we
edit `/etc/default/grub` or `/etc/grub.d/` and then execute:

```bash
grub-mkconfig -o /boot/grub/grub.cfg
grub-mkconfig > /boot/grub/grub.cfg
```

> ðŸ’¡ You can use `update-grub` for a front-end of above commands. i location o ðŸ˜
> `/etc/grub.d/` files are each a part of the main `/boot/grub/grub.cfg`.

#### Simple Example of grub.cfg

```bash
set default="0"
menuentry "Fedora" {
  set root=(hd0,1)
  linux /boot/vmlinuz-5.10.0-9-arm64 ro quiet
  initrd /boot/initrd.img-5.10.0-9-arm64
}
menuentry "Windows" {
  chainloader (hd1,msdos2)+1
}
```

| Option         | Description                                       |
| -------------- | ------------------------------------------------- |
| menuentry      | Defines a new menuentry.                          |
| set root       | Defines the root where `/boot` is located.        |
| linux, linux16 | Define the Linux Kernel location on BIOS systems. |
| linuxefi       | Define the Linux Kernel location on UEFI systems. |
| initrd         | Define the initramfs location on BIOS systems.    |
| initrdefi      | Define the initramfs location on UEFI systems.    |

#### Interacting with Grub2 Command Line

Press `c` to the grub2 command line. Then you can load the kernel, initramfs, and boot.

```bash
grub> linux /boot/vmlinuz ro root=/dev/sda3
grub> initrd /boot/initrd.img
grub> boot
```

Voila! You have your cute little system back!
