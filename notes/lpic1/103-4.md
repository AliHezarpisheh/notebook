# Use Streams, Pipes, and Redirects

## Redirecting Standard IO

On Linux systems, most shells use streams for input and output. These streams can be
form (and toward) various things including keyboards, block devices, files, etc.

Every linux command interacts with three numbered data streams:

| Stream     | Number | Meaning                                     |
| ---------- | ------ | ------------------------------------------- |
| **stdin**  | `0`    | Input TO the command (keyboard, pipe, file) |
| **stdout** | `1`    | Normal output FROM the command              |
| **stderr** | `2`    | Error messages FROM the command             |

Redirection and operators you can use:

| Operator | Usage                                                                |
| -------- | -------------------------------------------------------------------- |
| >        | Redirects stdout to a file, overwrites if it exists.                 |
| >>       | Redirects stdout to a file, appends if it exists.                    |
| 2>       | Redirects stderr to a file, overwrites if it exists.                 |
| 2>>      | Redirects stderr to a file, appends if it exists.                    |
| &>       | Redirects both stdout and stderr to a file, overwrites if it exists. |
| &>>      | Redirects both stdout and stderr to a file, appends if it exists.    |
| \<       | Redirects stdin from a file.                                         |
| \<>      | Redirects stdin from the file and send the stdout to it.             |

> `&0`, `&1`, and `&2` refer to file descriptors. When you use `&1` means use the stdout
> file descriptor as target.

### here-documents

Many shells have here-documents as a way of input. You can use `<<` and a `WORD` and
then whatever you input is considered stdin till you give only the WORLD in one line.

```bash
tr ' ' '.' << END
> Hi my name is ali
> I am just saying random shit
> I am learning lpic1 and I am at 103.4 lesson
> END
Hi.my.name.is.ali
I.am.just.saying.random.shit
I.am.learning.lpic1.and.I.am.at.103.4.lesson
```

## Pipes

With pipes you can redirect STDOUT, STDIN, and STDERR between multiple commands all on
one command line. When you do `command1 | command2`; command1, is executed but the
stdout of it is redirected as stdin of command2.

```bash
cat who_uses_what.txt
jadi, fedora
linux, fedora
bob, ubuntu
jack, arch
sara, fedora

cut -f2 -d, who_uses_what.txt | sed -e 's/ //g' | sort  | uniq -c | sort -nr
   3 fedora
   1 ubuntu
   1 arch
```

## xargs

The xargs utility reads space, tab, newline, and end-of-file delimited strings from the
standard input and execute the provided utility with the strings as their arguments. The
default command of xargs is `echo`.

Use `-I` switch to kinda assign the input to a variable.

```bash
ls | xargs -I FILE echo "Awesome file : FILE"
```

`-n 1` switch tells xargs to invoke the provided utility after receiving 1 argument.
`-L 1` breaks based on new lines.

## tee

The problem of redirection is that we won't have th redirected stream in the terminal no
more. The `tee` command solves it.

```bash
ls | tee fil_names
a
idk
ls
a  fil_names  idk
cat fil_names
a
idk
```

`-a` switch will append to file if it exists.

## EXTRA

### What is .bashrc

Think `.bashrc` as a startup script for the bash. Every time you open a new terminal
window, Bash automatically reads and executes all the commands in this file. People use
it mostly for:

- Setting aliases.
- Setting environment variables.
- Configure their prompt.
- Enable shell completions.

### eval

`eval` takes a string and make the shell execute it as a command. It is useful to
dynamically build commands. Dangerous if the input is not trusted.

```bash
cmd="ls -l /etc"
eval "$cmd"
```

### $(command)

`$(command)` is command substitution. The shell will run the command inside the $(),
capture its stdout, and substitutes it into the surrounding command as plain text.

### $

In shell, `$` generally means: perform expansion. Basically telling the shell to replace
something with something else. Lets see its usage:

- Variable expansion: `echo $HOME`.
- Parameter expansion: `echo ${USER:-unknown}`. Like variable expansion coming with
  modifiers.
- Command substitution: `echo "Today date: $(date)"`.
- Arithmetic expansion: `echo $((1 + 2))`.
- Positional parameters: `echo $1, $2, ...`.
